<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Train Schedules - RailMitra</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="schedule.css">
    <!-- Datepicker CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
</head>
<body class="bg-smooth-gradient">
    <!-- Content Section -->
    <div class="container mt-5">
       <!-- Train Search Tabs -->
       <div class="search-tabs">
           <div class="search-tab active" id="searchByNumberTab">Search by Train Number</div>
           <div class="search-tab" id="searchByRouteTab">Search by Source and Destination</div>
       </div>
       
       <!-- Train Search Form - By Train Number -->
       <div id="numberSearch" class="search-form">
           <form id="searchByNumberForm">
               <label for="trainNumber">Enter Train Number:</label>
               <input type="text" class="form-control" id="trainNumber" name="trainNumber">
               <button type="submit" class="btn btn-primary mt-2">Search</button>
           </form>
       </div>
       
       <!-- Train Search Form - By Source and Destination -->
       <div id="routeSearch" class="search-form" style="display:none;">
           <form id="searchByRouteForm">
               <label for="source">Source:</label>
               <input type="text" class="form-control" id="source" name="source">
               <label for="destination">Destination:</label>
               <input type="text" class="form-control" id="destination" name="destination">
               <label for="date">Date:</label>
               <input type="text" class="form-control" id="datepicker" name="date">
               <button type="submit" class="btn btn-primary mt-2">Search</button>
           </form>
       </div>
       
       <!-- Train Schedules Section -->
       <div class="card mt-4">
           <div class="card-body">
               <h2 class="card-title text-primary">Train Schedules</h2>
               <table class="schedule-table">
                   <thead>
                       <tr>
                           <th>Train Number</th>
                           <th>Train Name</th>
                        
                           <th>Route</th>
                       </tr>
                   </thead>
                   <tbody>
                       <!-- Table rows will be dynamically added here -->
                   </tbody>
               </table>
           </div>
       </div>
    </div>
    <!-- Firebase JavaScript SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        // Your Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyCzF2lQO3f2O7BxCMStuwTZXiP5GCccH48",
            authDomain: "railmitra-29557.firebaseapp.com",
            projectId: "railmitra-29557",
            storageBucket: "railmitra-29557.appspot.com",
            messagingSenderId: "269756755900",
            appId: "1:269756755900:web:69d475147946f789fdc5b9",
            measurementId: "G-T0MQQ6JMLD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // Function to handle change in search type
        document.querySelectorAll('.search-tab').forEach(function(tab) {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.search-tab').forEach(function(tab) {
                    tab.classList.remove('active');
                });
                this.classList.add('active');

                var searchType = this.id;
                if (searchType === 'searchByNumberTab') {
                    document.getElementById('numberSearch').style.display = 'block';
                    document.getElementById('routeSearch').style.display = 'none';
                } else {
                    document.getElementById('numberSearch').style.display = 'none';
                    document.getElementById('routeSearch').style.display = 'block';
                    $('#datepicker').datepicker({
                        autoclose: true,
                        format: 'dd/mm/yyyy',
                        todayHighlight: true
                    });
                }
            });
        });

        // Function to handle form submission for searching by train number
        document.getElementById('searchByNumberForm').addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent form submission
            var trainNumber = document.getElementById('trainNumber').value;
            // Now call the searchByTrainNumber function correctly
            await searchByTrainNumber(trainNumber);
        });

        // Function to search trains by train number
        async function searchByTrainNumber(trainNumber) {
            console.log("Starting search by train number:", trainNumber);

            // Ensure db is defined and initialized elsewhere in your code
            if (!db) {
                console.error("Database instance is not available.");
                return;
            }

            try {
                // Reference to the "seats" collection in Firestore
                const seatsCollectionRef = collection(db, "seats");

                // Constructing the query to fetch all documents where 'train number' matches the specified train number
                const q = query(seatsCollectionRef, where("train number", "==", trainNumber));

                // Execute the query
                const querySnapshot = await getDocs(q);
                console.log("Query executed successfully.");

                // Clear the previous results
                const resultsTableBody = document.querySelector('.schedule-table tbody');
                resultsTableBody.innerHTML = '';

                // Process each document returned by the query
                querySnapshot.forEach((doc) => {
                    const trainData = doc.data();

                    // Create a new row and populate it with the train data
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${trainData['train number']}</td>
                        <td>${trainData['train name']}</td>
               
                    `;

                    // Append the row to the table body
                    resultsTableBody.appendChild(row);
                });

                console.log("Search completed.");
            } catch (error) {
                console.error("Error executing query:", error);
            }
        }

        // Function to handle form submission for searching by source, destination, and date
        document.getElementById('searchByRouteForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent form submission
            var source = document.getElementById('source').value;
            var destination = document.getElementById('destination').value;
            var date = document.getElementById('datepicker').value;
            // Call function to search by source, destination, and date
            searchBySourceAndDestination(source, destination, date);
        });

        // Placeholder for the searchBySourceAndDestination function
        function searchBySourceAndDestination(source, destination, date) {
            console.log("Searching by source: " + source + ", destination: " + destination + ", and date: " + date);
        }
    </script>

    <!-- Bootstrap JS and Dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
</body>
</html>
