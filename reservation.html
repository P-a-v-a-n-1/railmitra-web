<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Indian Railways Reservation</title>
    <!-- Bootstrap CSS -->
    <link
        rel="stylesheet"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <!-- Google Fonts for Custom Font -->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap"
        rel="stylesheet"
    />
    <!-- Font Awesome for Icons -->
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <!-- Custom CSS for Gradient Background and Animations -->
    <style>
        body {
            /* Color Palette Variables */
            --primary-color: #5356FF; /* Dark Blue */
            --secondary-color: #378CE7; /* Medium Blue */
            --tertiary-color: #67C6E3; /* Light Blue */
            --background-color: #DFF5FF; /* Very Light Blue */

            /* Gradient Background */
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--tertiary-color)); /* Gradient background */
            font-family: 'Poppins', sans-serif; /* Custom font */
            min-height: 100vh; /* Ensure full screen coverage */
            display: flex;
            flex-direction: column; /* Flexbox for vertical layout */
            justify-content: space-between; /* Space between content and footer */
        }

        /* Card Styling with Animation */
        .reservation-card {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); /* Shadow effect */
            transition: transform 0.3s, box-shadow 0.3s; /* Smooth animations */
        }

        .reservation-card:hover {
            transform: translateY(-10px); /* Hover effect */
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3); /* Increased shadow */
        }

        /* Form Header with Animation */
        .form-header {
            text-align: center;
            color: var(--primary-color); /* Dark blue for the header */
            margin-bottom: 20px;
            animation: fadeIn 1s ease-in; /* Smooth animation on load */
        }

        /* Input Field Styling */
        .form-control {
            border: 1px solid var(--secondary-color); /* Blue border */
            transition: border-color 0.3s, box-shadow 0.3s; /* Smooth transitions */
        }

        .form-control:focus {
            border-color: var(--primary-color); /* Darker blue on focus */
            box-shadow: 0 0 10px rgba(83, 86, 255, 0.3); /* Blue glow */
        }

        /* Submit Button Styling */
        .btn-custom {
            background-color: var(--primary-color); /* Dark blue */
            color: white;
            transition: background-color 0.3s; /* Smooth hover transition */
        }

        .btn-custom:hover {
            background-color: var(--secondary-color); /* Change color on hover */
        }

        /* Footer Styling */
        .footer {
            background-color: var(--primary-color); /* Dark blue background */
            color: white; /* White text */
            text-align: center; /* Centered text */
            padding: 10px;
            border-radius: 10px; /* Rounded corners */
            position: fixed; /* Fixed at the bottom */
            bottom: 0;
            width: 100%; /* Full width to span the screen */
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <!-- Reservation Card -->
    <div class="reservation-card">
        <!-- Form Header -->
        <h2 class="form-header">Railway Reservation Form</h2>

        <!-- Form Content -->
        <form id="reservation-form">
            <!-- Passenger Information -->
            <div class="form-group">
                <label for="passenger-name">Passenger Name</label>
                <input type="text" id="passenger-name" class="form-control" placeholder="Enter your name" required>
            </div>

            <div class="form-group">
                <label for="passenger-age">Passenger Age</label>
                <input type="number" id="passenger-age" class="form-control" placeholder="Enter your age" required>
            </div>

            <!-- Journey Information -->
            <div class="form-group">
                <label for="departure-station">Departure Station</label>
                <input type="text" id="departure-station" class="form-control" placeholder="Enter departure station" required>
            </div>

            <div class="form-group">
                <label for="arrival-station">Arrival Station</label>
                <input type="text" id="arrival-station" class="form-control" placeholder="Enter arrival station" required>
            </div>

            <div class="form-group">
                <label for="journey-date">Journey Date</label>
                <input type="date" id="journey-date" class="form-control" required>
            </div>

            <!-- Class of Travel -->
            <div class="form-group">
                <label for="class-of-travel">Class of Travel</label>
                <select id="class-of-travel" class="form-control" required>
                    <option value="">Select Class</option>
                    <option value="1AC">First Class AC (1AC)</option>
                    <option value="2AC">Second Class AC (2AC)</option>
                    <option value="3AC">Third Class AC (3AC)</option>
                    <option value="SL">Sleeper Class (SL)</option>
                    <option value="2S">Second Sitting (2S)</option>
                </select>
            </div>

            <!-- Berth Preference -->
            <div class="form-group">
                <label for="berth-preference">Berth Preference</label>
                <select id="berth-preference" class="form-control" required>
                    <option value="">Select Berth Preference</option>
                    <option value="upper">Upper Berth</option>
                    <option value="middle">Middle Berth</option>
                    <option value="lower">Lower Berth</option>
                </select>
            </div>
            
            <!-- Payment Method -->
            <div class="form-group">
                <label for="payment-method">Payment Method</label>
                <select id="payment-method" class="form-control" required>
                    <option value="">Select Payment Method</option>
                    <option value="credit-card">Credit/Debit Card</option>
                    <option value="wallet">e-Wallet</option>
                </select>
            </div>

            <!-- Submit Button -->
            <div class="form-group text-center">
                <button type="submit" class="btn btn-custom">Reserve Ticket</button>
            </div>
        </form>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Reservation Confirmation</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="confirmationMessage">
                <!-- Confirmation message will be inserted here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<div class="footer">
    &copy; 2024 Indian Railways. All rights reserved.
</div>

<!-- Bootstrap JS and Dependencies -->
<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha384-ZvpUoO/+P6rXIQk5kHkPo3L6KoPTVZ8jIzsQWZpTQ8TXYhN6vjyxDfImLzMHO8js"
    crossorigin="anonymous"
></script>
<script
    src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"
    integrity="sha384-r3PzYY2t6WobX5EJ4/8rA7epFZw4yPUFBLl5C3gX3fb0F2yRRDmbPCmIGc7mleP4"
    crossorigin="anonymous"
></script>

<!-- Firebase App (the core Firebase SDK) -->
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<!-- Firebase Auth SDK -->
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
<!-- Firebase Firestore SDK -->
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

<script>
    // Your Firebase configuration
    var firebaseConfig = {
            apiKey: "AIzaSyCzF2lQO3f2O7BxCMStuwTZXiP5GCccH48",
            authDomain: "railmitra-29557.firebaseapp.com",
            projectId: "railmitra-29557",
            storageBucket: "railmitra-29557.appspot.com",
            messagingSenderId: "269756755900",
            appId: "1:269756755900:web:69d475147946f789fdc5b9",
            measurementId: "G-T0MQQ6JMLD"
        };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();

    // Handle form submission
    document.getElementById('reservation-form').addEventListener('submit', function(e) {
        e.preventDefault();

        // Get form data
        var name = document.getElementById('passenger-name').value;
        var age = document.getElementById('passenger-age').value;
        var departure = document.getElementById('departure-station').value;
        var arrival = document.getElementById('arrival-station').value;
        var date = document.getElementById('journey-date').value;
        var travelClass = document.getElementById('class-of-travel').value;
        var berth = document.getElementById('berth-preference').value;
        var paymentMethod = document.getElementById('payment-method').value;

        // Create a reference to the train document
        var trainRef = db.collection('trains').doc(departure + '-' + arrival + '-' + date);

        // Check train and seat availability
        db.runTransaction(function(transaction) {
            return transaction.get(trainRef).then(function(trainDoc) {
                if (!trainDoc.exists) {
                    throw 'Train not found for the selected route and date.';
                }

                var availableSeats = trainDoc.data().availableSeats;
                if (availableSeats <= 0) {
                    throw 'No available seats for this train.';
                }

                // Update available seats
                transaction.update(trainRef, {
                    availableSeats: firebase.firestore.FieldValue.increment(-1)
                });

                // Add reservation to database
                var reservationRef = db.collection('reservations').doc();
                transaction.set(reservationRef, {
                    name: name,
                    age: age,
                    departure: departure,
                    arrival: arrival,
                    date: date,
                    class: travelClass,
                    berth: berth,
                    paymentMethod: paymentMethod,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            });
        }).then(function() {
            // Show confirmation modal
            var confirmationMessage = `
                <p>Ticket booked successfully!</p>
                <p><strong>Name:</strong> ${name}</p>
                <p><strong>Departure:</strong> ${departure}</p>
                <p><strong>Arrival:</strong> ${arrival}</p>
                <p><strong>Date:</strong> ${date}</p>
                <p><strong>Class:</strong> ${travelClass}</p>
                <p><strong>Berth:</strong> ${berth}</p>
                <p><strong>Payment Method:</strong> ${paymentMethod}</p>
            `;
            document.getElementById('confirmationMessage').innerHTML = confirmationMessage;
            $('#confirmationModal').modal('show');
        }).catch(function(error) {
            alert('Error: ' + error);
            console.error('Transaction failed: ', error);
        });
    });

    // Redirect to payment page based on selected payment method
    document.getElementById('payment-method').addEventListener('change', function() {
        const selectedValue = this.value;
        if (selectedValue === 'credit-card') {
            window.location.href = 'creditcard.html';
        } else if (selectedValue === 'wallet') {
            window.location.href = 'ewallet.html';
        }
    });

    // Redirect to payment page based on selected payment method
   
    document.getElementById('payment-method').addEventListener('change', function() {
        const selectedValue = this.value;
        if (selectedValue === 'credit-card') {
            window.location.href = 'creditcard.html';
        } else if (selectedValue === 'wallet') {
            window.location.href = 'ewallet.html';
        }
    });

</script>
</body>
</html>
